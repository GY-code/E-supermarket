<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.exrick.mapper.TbCartMemberMapper">

    <select id="getCartIdByUserId" parameterType="long" resultType="java.lang.Long">
        select cart_id from tb_cart
        <where>
            <if test="userId != null">
                customer_id = #{userId}
            </if>
        </where>
    </select>

    <resultMap id="getCart" type="cn.exrick.pojo.front.Cart">
        <result column="cart_id" property="cartId"/>
        <result column="product_id" property="productId"/>
        <result column="checked" property="checked"/>
        <result column="product_num" property="productNum"/>
        <result column="join_time" property="joinTime"/>
        <result column="price" property="salePrice"/>
        <result column="image" property="productImg"/>
        <result column="limit_num" property="limitNum"/>
        <result column="title" property="productName"/>
    </resultMap>
    <select id="getCartList" parameterType="long" resultMap="getCart">
        select a.cart_id,a.product_id,a.checked,a.product_num,a.join_time,c.price,c.image,c.limit_num,c.title
        from tb_cart_customer a, tb_cart b,tb_item c
        <where>
            a.cart_id = b.cart_id
            and a.product_id = c.id
            <if test="userId != null">
                and b.customer_id = #{userId}
            </if>
        </where>
    </select>

    <insert id="addCart" parameterType="cn.exrick.pojo.front.Cart">
        insert into tb_cart_customer (cart_id, product_id,checked,product_num,join_time)
        values (#{cartId}, #{productId},#{checked}, #{productNum},#{joinTime})
    </insert>

    <update id="updateCart" parameterType="map">
        update tb_cart_customer
        <set>
            <if test="productNum != null">
                product_num = #{productNum},
            </if>
            <if test="checked != null">
                checked = #{checked}
            </if>
        </set>
        <where>
            <if test="cartId != null">
                cart_id = #{cartId}
            </if>
            <if test="productId != null">
                and product_id = #{productId}
            </if>
        </where>
    </update>

    <delete id="deleteCart" parameterType="cn.exrick.pojo.front.Cart">
        delete from tb_cart_customer
        <where>
            <if test="cartId != null">
                cart_id =#{cartId}
            </if>
            <if test="productId != null">
                and product_id = #{productId}
            </if>
        </where>
    </delete>

    <delete id="deleteCartSelected" parameterType="cn.exrick.pojo.front.Cart">
        delete from tb_cart_customer
        <where>
            <if test="cartId != null">
                cart_id =#{cartId}
            </if>
            <if test="checked != null">
                and checked = 1;
            </if>
        </where>
    </delete>

    <select id="getCartByCartIdAndProductId" parameterType="map" resultType="java.lang.Long">
        select cart_id from tb_cart_customer
        <where>
            cart_id = #{cartId}
            and product_id = #{productId}
        </where>
    </select>

    <select id="getProductNum" parameterType="map" resultType="java.lang.Integer">
        select product_num from tb_cart_customer
        <where>
            cart_id = #{cartId}
            and product_id = #{productId}
        </where>
    </select>
</mapper>